<div class="mt-8 pt-6 border-t border-fuchsia-950/10">
    <div class="text-center space-y-4">
        <div id="progress-indicator" class="mb-4">
            <div class="flex items-center justify-center space-x-2 text-sm text-(--therapy-tips-text) mb-2">
                <img src="https://unpkg.com/lucide-static@latest/icons/check-circle.svg"
                     class="size-4" />
                <span id="progress-text">0 of 0 questions answered</span>
            </div>
            <div class="w-full bg-fuchsia-100 rounded-full h-2">
                <div id="progress-bar" 
                     class="bg-(--therapy-tips) h-2 rounded-full transition-all duration-300" 
                     style="width: 0%"></div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('personality-test-form');
    const progressBar = document.getElementById('progress-bar');
    const progressText = document.getElementById('progress-text');
    const submitButton = document.getElementById('submit-button');
    // Get total questions by counting question elements in the DOM
    const totalQuestions = document.querySelectorAll('[data-question-index]').length;
    
    function updateProgress() {
        let answeredQuestions = 0;
        console.log('Checking progress for', totalQuestions, 'questions'); // Debug
        
        for (let i = 0; i < totalQuestions; i++) {
            let isAnswered = false;
            
            // Check mobile hidden input first
            const hidden = document.getElementById(`question_${i}_input`);
            if (hidden && hidden.value && hidden.value.trim() !== '') {
                isAnswered = true;
                console.log(`Question ${i} answered via mobile:`, hidden.value); // Debug
            }
            
            // If not answered via mobile, check desktop radio
            if (!isAnswered) {
                const checked = form.querySelector(`input[name="question_${i}"]:checked`);
                if (checked) {
                    isAnswered = true;
                    console.log(`Question ${i} answered via desktop:`, checked.value); // Debug
                }
            }
            
            if (isAnswered) {
                answeredQuestions++;
            }
        }
        
        const percentage = (answeredQuestions / totalQuestions) * 100;
        
        console.log('Progress:', answeredQuestions, 'of', totalQuestions, 'answered'); // Debug
        
        progressBar.style.width = percentage + '%';
        progressText.textContent = `${answeredQuestions} of ${totalQuestions} questions answered`;
        
        // Enable submit button only when all questions are answered
        if (answeredQuestions === totalQuestions) {
            submitButton.disabled = false;
            submitButton.classList.remove('opacity-50', 'cursor-not-allowed');
            console.log('Submit button enabled'); // Debug
        } else {
            submitButton.disabled = true;
            submitButton.classList.add('opacity-50', 'cursor-not-allowed');
            console.log('Submit button disabled'); // Debug
        }
    }
    
    // Listen for changes to radio buttons and other form elements
    form.addEventListener('change', function(e) {
        console.log('Form change detected:', e.target.type, e.target.name); // Debug
        if (e.target.type === 'radio' && e.target.name && e.target.name.startsWith('question_')) {
            // Clear any error highlight on this question block
            const idx = e.target.name.split('_')[1];
            const questionBlock = document.querySelector(`[data-question-index="${idx}"]`);
            if (questionBlock) {
                questionBlock.style.outline = 'none';
                questionBlock.style.outlineOffset = '';
            }
            updateProgress();
        }
        // Also trigger for any other form changes
        if (e.target.name && (e.target.name.startsWith('question_') || e.target.name === 'age' || e.target.name === 'gender' || e.target.name === 'region' || e.target.name === 'firstName')) {
            updateProgress();
        }
    });
    
    // Listen for custom events from mobile dropdowns
    document.addEventListener('questionAnswered', updateProgress);
    
    // Initial progress update
    updateProgress();
    
    // Backup: Also check progress every 1000ms to catch any missed updates
    setInterval(updateProgress, 1000);
});
</script> 