<form id="personality-test-form" class="flex flex-col gap-6">
    <div class="rounded-lg p-6 shadow-md">
        <input type="hidden" name="testId" value="<%= testId %>">
        <p class="text-lg text-(--therapy-tips-text) font-medium">
            <strong>Step 1:</strong> Rate the following statements based on how much you agree with them on a scale of strongly disagree to strongly agree.
        </p>
        <% questions.forEach((question, index) => { %>
            <%- include('personalitytest-question', { 
                question: question, 
                questionIndex: index 
            }) %>
        <% }); %>
        <%- include('personalitytest-submit') %>
    </div>

    <div class="rounded-lg p-6 shadow-md">
        <%- include('personalitytest-userdetails') %>
    </div>

    <!-- <div class="rounded-lg p-6 shadow-md">
        <%#- include('personalitytest-results') %>
    </div> -->
</form>

<script>
document.getElementById('personality-test-form').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const formData = new FormData(this);
    const responses = {};
    let totalScore = 0;
    let answeredQuestions = 0;
    
    // Collect all responses
    for (let [key, value] of formData.entries()) {
        if (key.startsWith('question_')) {
            responses[key] = parseInt(value);
            totalScore += parseInt(value);
            answeredQuestions++;
        }
    }
    
    // Check if all questions are answered
    const totalQuestions = questions.length;
    if (answeredQuestions < totalQuestions) {
        alert('Please answer all questions before submitting.');
        return;
    }
    
    // Calculate average score
    const averageScore = totalScore / totalQuestions;
    
    // Show results
    showResults(averageScore, totalScore);
    
    // Scroll to results
    document.getElementById('test-results').scrollIntoView({ 
        behavior: 'smooth',
        block: 'start'
    });
});

function showResults(averageScore, totalScore) {
    const resultsDiv = document.getElementById('test-results');
    const resultsContent = document.getElementById('results-content');
    
    let interpretation = '';
    let level = '';
    
    // Interpret results based on average score (1-5 scale)
    if (averageScore >= 4.5) {
        level = 'High';
        interpretation = 'You demonstrate excellent active-empathic listening skills. You are highly attuned to others\' emotions and respond with genuine empathy and understanding.';
    } else if (averageScore >= 3.5) {
        level = 'Moderate';
        interpretation = 'You have good active-empathic listening skills with room for improvement. You generally understand others\' feelings but could work on being more consistently empathetic.';
    } else if (averageScore >= 2.5) {
        level = 'Developing';
        interpretation = 'Your active-empathic listening skills are developing. Focus on being more present and emotionally attuned when listening to others.';
    } else {
        level = 'Low';
        interpretation = 'Your active-empathic listening skills could benefit from significant improvement. Consider practicing mindful listening and emotional awareness techniques.';
    }
    
    resultsContent.innerHTML = `
        <div class="text-center mb-4">
            <div class="text-3xl font-bold text-(--therapy-tips) mb-2">${averageScore.toFixed(1)}/5</div>
            <div class="text-lg font-semibold text-(--therapy-tips-text)">${level} Active-Empathic Listening</div>
        </div>
        <p class="text-base leading-relaxed mb-4">${interpretation}</p>
        <div class="bg-fuchsia-400/10 rounded-lg p-4">
            <h5 class="font-semibold text-(--therapy-tips) mb-2">Score Breakdown:</h5>
            <ul class="text-sm text-(--therapy-tips-text) space-y-1">
                <li>Total Score: ${totalScore}/<%= questions.length * 5 %></li>
                <li>Average Score: ${averageScore.toFixed(2)}/5</li>
                <li>Questions Answered: <%= questions.length %></li>
            </ul>
        </div>
    `;
    
    resultsDiv.classList.remove('hidden');
}</script> 